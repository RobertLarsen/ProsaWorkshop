Anden opgave
------------
[source,c]
------------------------------------------------
include::../assignments/integer_conversion.bug[]
------------------------------------------------

Anden opgave
------------

Integer conversion!

[source,c]
------------------------------------------------
int num_users; /* <- Signed integer */

if (num_users <= MAX_USERS_PER_CHUNK) /* <- Signed comparison */

/* Prototype for read. 'count' er unsigned! */
ssize_t read(int fd, void *buf, size_t count);

/* Her går det galt */
read(socket, users, num_users * sizeof(user_t)); 
------------------------------------------------

Anden opgave
------------

[frame="topbot",options="header"]
|==========================================================================
| Beregning         | Binær repræsentation | Signed værdi | Unsigned værdi
| '-1'              | '0xffffffff'         | -1           | 4294967296
| '-1 * 40'         | '0xffffffd8'         | -40          | 4294967256
|==========================================================================

[source,c]
------------------------------------------------
/* Vi sender -1 */
read(socket, &num_users, sizeof(num_users));
if (-1 <= 8) {
    read(socket, users, 4294967256);
}
------------------------------------------------

Anden opgave
------------

Lytter på 'localhost:10001'

Find processen på jeres Vagrant box med:

[source,bash]
------------------------------------------------
$ ps aux | grep exploitation | grep 10001 | awk '{print $2}'
3461
------------------------------------------------

Attach gdb med:

[source,bash]
------------------------------------------------
$ sudo gdb $A 3461
------------------------------------------------

'$A' er en environment variable som peger på vores executable.

Anden opgave - VirtualBox bug
-----------------------------

Hvis I ikke kan forbinde til processen, så er det nok pga. en fejl i VirtualBox som indtræder, når man har suspenderet og startet sin VM. Fix det sålades:

[source,bash]
------------------------------------------------
$ sudo service docker restart
------------------------------------------------

Tredje opgave
-------------

[source,c]
------------------------------------------------
include::../assignments/integer_overflow.bug[]
------------------------------------------------

Tredje opgave
-------------

Samme problem som i anden opgave, men her afslutter read loopet ikke før alle bytes er modtaget...og fire gigabytes er meget data!

Tredje opgave
-------------

Integer overflow!

[frame="topbot",options="header"]
|=====================================================================================
| Beregning            | Binær repræsentation         | Signed værdi | Unsigned værdi
| '0x14'               | '0x14'                       | 20           | 20
| '0x14 \| 0x80000000' | '0x80000014'                 | -2147483628  | 2147483668
| '0x80000014 * 40'    | '0x1400000320' eller '0x320' | 800          | 800
|=====================================================================================

[source,c]
------------------------------------------------
/* Vi sender 0x80000014 */
if (read_full(socket, &num_users, sizeof(num_users))) {
    if (-2147483628 <= 8) {
        if (read_full(socket, users, 800)) {
------------------------------------------------

Tredje opgave
-------------

Lytter på 'localhost:10002'

Find processen på jeres Vagrant box med:

[source,bash]
------------------------------------------------
$ ps aux | grep exploitation | grep 10002 | awk '{print $2}'
3945
------------------------------------------------

Attach gdb med:

[source,bash]
------------------------------------------------
$ sudo gdb $B 3945
------------------------------------------------
